---
import Footer from "@components/Footer.astro";
import Header from "@components/Header.astro";
import NovelCard from "@components/NovelCard.astro";
import Layout from "@layouts/Layout.astro";

const API_URL = import.meta.env.PUBLIC_API_URL;



async function fetchNovels() {
  return await fetch(`${API_URL}/novels`).then(res => res.json());
}

const novels = await fetchNovels();

for (const novel of novels) {
  const status = await fetchNovelStatus(novel);
  novel.status = status;
}

async function fetchNovelStatus(novel: { ID: number; }) {
  const response = await fetch(`${API_URL}/novels/chapters-stats/${novel.ID}`);
  const status = await response.json();
  return status;
}


---

<Layout>
  <Header activeNav="novels" />
  <main>
    <div class="flex flex-col items-center justify-center py-12">
      <NovelCard novels={novels} />
    </div>
  </main>
  <Footer />
</Layout>
